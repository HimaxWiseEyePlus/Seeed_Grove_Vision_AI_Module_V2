# directory declaration
LIB_SECURITY_DIR = $(LIBRARIES_ROOT)/security

LIB_SECURITY_ASMSRCDIR	= $(LIB_SECURITY_DIR) $(LIB_SECURITY_DIR)/src
LIB_SECURITY_CSRCDIR	= $(LIB_SECURITY_DIR) $(LIB_SECURITY_DIR)/src
LIB_SECURITY_INCDIR	= $(LIB_SECURITY_DIR) $(LIB_SECURITY_DIR)/inc

# find all the source files in the target directories
LIB_SECURITY_CSRCS = $(call get_csrcs, $(LIB_SECURITY_CSRCDIR))
LIB_SECURITY_ASMSRCS = $(call get_asmsrcs, $(LIB_SECURITY_ASMSRCDIR))

# get object files
LIB_SECURITY_COBJS = $(call get_relobjs, $(LIB_SECURITY_CSRCS))
LIB_SECURITY_ASMOBJS = $(call get_relobjs, $(LIB_SECURITY_ASMSRCS))
LIB_SECURITY_OBJS = $(LIB_SECURITY_COBJS) $(LIB_SECURITY_ASMOBJS)

# get dependency files
LIB_SECURITY_DEPS = $(call get_deps, $(LIB_SECURITY_OBJS))

# extra macros to be defined
LIB_SECURITY_DEFINES = -DLIB_SECURITY

# genearte library
SECURE_LIB = $(OUT_DIR)/libsecurity_$(TOOLCHAIN).a
ifeq ($(SUPPORT_SEC_LIB), y)
ifeq "$(HOST_OS)" "Windows"
SECURE_BUILD_LIB = $(BOARD_OUT_DIR)\$(BUILD_INFO)\libsecurity_$(TOOLCHAIN).a 
SECURE_PREBUILT_LIB = .\library\security\libsecurity_$(TOOLCHAIN).a
else
SECURE_BUILD_LIB = $(BOARD_OUT_DIR)/$(BUILD_INFO)/libsecurity_$(TOOLCHAIN).a
SECURE_PREBUILT_LIB = ./library/security/libsecurity_$(TOOLCHAIN).a
endif

$(SECURE_LIB) : 
	$(CP) $(SECURE_PREBUILT_LIB) $(SECURE_BUILD_LIB)
endif

# Secure source define
APPL_DEFINES += -DCC_CONFIG_SUPPORT_SB_RT
APPL_DEFINES += -DUSE_MBEDTLS_CRYPTOCELL
APPL_DEFINES += -DCC_IOT
APPL_DEFINES += -DDLLI_MAX_BUFF_SIZE=0x10000
APPL_DEFINES += -DCC_SB_DOUBLE_BUFFER_MAX_SIZE_IN_BYTES=8192
APPL_DEFINES += -DCC_MNG_MIN_BACKUP_SIZE_IN_BYTES=512
APPL_DEFINES += -DFW_ENABLE_AES_DRIVER=1
APPL_DEFINES += -DCC_SB_INDIRECT_SRAM_ACCESS=1
APPL_DEFINES += -DCC_SB_CERT_VERSION_MAJOR=1
APPL_DEFINES += -DCC_SB_CERT_VERSION_MINOR=0
APPL_DEFINES += -DCC_SB_CC3X=1
APPL_DEFINES += -DCC_SRAM_INDIRECT_ACCESS=1
APPL_DEFINES += -DMD5_HASH_EXCLUDED
APPL_DEFINES += -DCC_DOUBLE_BUFFER_MAX_SIZE_IN_BYTES=0
APPL_DEFINES += -DCC_SB_SUPPORT_IOT
APPL_DEFINES += -DCC_CONFIG_TRNG_MODE=1
APPL_DEFINES += -DMONTANA_CID=201
APPL_DEFINES += -DMBEDTLS_RSA_NO_CRT
APPL_DEFINES += -DMBEDTLS_CONFIG_FILE
APPL_DEFINES += -DIDE_ARM_DS


# specific compile rules
# user can add rules to compile this middleware
# if not rules specified to this middleware, it will use default compiling rules

# Middleware Definitions
LIB_INCDIR += $(LIB_SECURITY_INCDIR)
LIB_CSRCDIR += $(LIB_SECURITY_CSRCDIR)
LIB_ASMSRCDIR += $(LIB_SECURITY_ASMSRCDIR)

LIB_CSRCS += $(LIB_SECURITY_CSRCS)
LIB_CXXSRCS +=
LIB_ASMSRCS += $(LIB_SECURITY_ASMSRCS)
LIB_ALLSRCS += $(LIB_SECURITY_CSRCS) $(LIB_SECURITY_ASMSRCS)

LIB_COBJS += $(LIB_SECURITY_COBJS)
LIB_CXXOBJS +=
LIB_ASMOBJS += $(LIB_SECURITY_ASMOBJS)
LIB_ALLOBJS += $(LIB_SECURITY_OBJS)

LIB_DEFINES += $(LIB_SECURITY_DEFINES)
LIB_DEPS += $(LIB_SECURITY_DEPS)
LIB_LIBS += $(SECURE_LIB)